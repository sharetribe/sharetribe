- content_for :javascript do
  initialize_profile_view(#{array_or_string_for_javascript(@person.badges.order("id DESC").limit(6).collect(&:name))});

- content_for :extra_javascript do
  = javascript_include_tag "https://maps.google.com/maps/api/js?sensor=true"
  
.view-profile

  .profile-description.section
  
    %h1
      = @person.name
    
    #profile_message_links
      %a.button{href: new_person_message_path(:person_id => @person.id, :message_type => "free", :profile_message => true)}
        .ss-compose.icon-with-text
        .text-with-icon= t(".contact", :person => @person.given_name_or_username)
    
    .profile-details
    
      .profile-image
        = large_avatar_thumb(@person)

      - if @person.description && !@person.description.blank?
        - text_with_line_breaks do
          = @person.description

      .profile-icons
        - if @person.phone_number && !@person.phone_number.blank?
          .profile-icon
            .ss-phone.icon-with-text
            .text-with-icon= @person.phone_number
        .profile-icon
          .ss-adduser.icon-with-text 
          .text-with-icon= t(".joined_this_community", :name => @person.given_name_or_username, :time_ago => time_ago(@community_membership.created_at))
        - if @community_membership.last_page_load_date
          .profile-icon
            .ss-refresh.icon-with-text
            .text-with-icon= t(".was_last_seen", :time_ago => time_ago(@community_membership.last_page_load_date))
        - if @community_membership.invitation && @community_membership.invitation.inviter
          .profile-icon
            .ss-users.icon-with-text
            .text-with-icon= t(".was_invited_by", :inviter_name => (link_to @community_membership.invitation.inviter.name, @community_membership.invitation.inviter)).html_safe
    
    - if logged_in? && @person.location && !@person.location.address.blank?
      #googlemap
        = render :partial => "googlemap"
        = render :partial => "profile_location", :locals => { :location => @person.location }
        
  .profile-listings.section
    %h2 
      .ss-page.icon-with-text
      .text-with-icon
        = t(".open_listings")
        %span= "(#{@listings.count})"
  
  .profile-testimonials.section
    %h2 
      .ss-like.icon-with-text
      .text-with-icon
        = t(".received_feedback")
    - if @person.received_testimonials.size > 0
      .small-text
        = "(#{@person.feedback_positive_percentage.to_s}% #{t("people.show.positive")}, #{@person.received_positive_testimonials.size}/#{@person.received_testimonials.size})"
    - if @person.received_testimonials.size > 0
      = render :partial => "testimonial", :collection => @person.received_testimonials.limit(3)
      .load-more-link
        = link_to "More reviews", "#"
    - else
      .load-more-link
        No reviews
  
  .profile-badges.section
    %h2 
      .ss-medal.icon-with-text
      .text-with-icon
        = t(".badges")
        %span= "(#{@listings.count})"
    = render :partial => "profile_badge", :collection => @person.badges.order("id DESC").limit(6), :as => :badge
    